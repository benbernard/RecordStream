.TH RECS\-COLLATE 1 "2026-02-24" "recs 0.1.0" "RecordStream Manual"

.SH NAME
recs\-collate \- Take records, grouped together by \-\-keys, and compute statistics (like average, count, sum, concat, etc

.SH SYNOPSIS
.B recs collate [options] [files...]

.SH DESCRIPTION
Take records, grouped together by \-\-keys, and compute statistics (like average, count, sum, concat, etc.) within those groups.
.PP

.SH OPTIONS
.TP
\fB--key\fR, \fB-k\fR \fI<keys>\fR
Comma\-separated list of key fields for grouping. May be a key spec or key group.
.TP
\fB--aggregator\fR, \fB-a\fR \fI<aggregators>\fR
Colon\-separated aggregator specification in the form [<fieldname>=]<aggregator>[,<arguments>].
.TP
\fB--dlaggregator\fR, \fB-A\fR \fI<name>=<expression>\fR
Domain language aggregator in the form name=expression. The expression is evaluated as JavaScript to produce an aggregator.
.TP
\fB--mr-agg\fR \fI<name> <map> <reduce> <squish>\fR
MapReduce aggregator: takes 4 arguments: name, map snippet, reduce snippet, squish snippet.
.TP
\fB--ii-agg\fR \fI<name> <initial> <combine> <squish>\fR
InjectInto aggregator: takes 4 arguments: name, initial snippet, combine snippet, squish snippet.
.TP
\fB--dlkey\fR, \fB-K\fR \fI<name>=<expression>\fR
Domain language key: name=expression where the expression evaluates as a valuation.
.TP
\fB--incremental\fR, \fB-i\fR
Output a record every time an input record is added to a clump (instead of every time a clump is flushed).
.TP
\fB--bucket\fR
Output one record per clump (default).
.TP
\fB--no-bucket\fR
Output one record for each record that went into the clump.
.TP
\fB--adjacent\fR, \fB-1\fR
Only group together adjacent records. Avoids spooling records into memory.
.TP
\fB--size\fR, \fB--sz\fR, \fB-n\fR \fI<number>\fR
Number of running clumps to keep.
.TP
\fB--cube\fR
Enable cube mode: output all key combinations with ALL placeholders.
.TP
\fB--clumper\fR, \fB-c\fR \fI<spec>\fR
Clumper specification (e.g. keylru,field,size or keyperfect,field or window,size).
.TP
\fB--dlclumper\fR, \fB-C\fR \fI<expression>\fR
Domain language clumper specification.
.TP
\fB--perfect\fR
Group records regardless of order (perfect hashing).
.TP
\fB--list-aggregators\fR
List available aggregators and exit.
.TP
\fB--show-aggregator\fR \fI<name>\fR
Show details of a specific aggregator and exit.
.TP
\fB--list-clumpers\fR
List available clumpers and exit.
.TP
\fB--show-clumper\fR \fI<name>\fR
Show details of a specific clumper and exit.

.SH EXAMPLES
Count number of each x field value in the entire file
.PP
.RS 4
.nf
\fBrecs collate --key x --aggregator count\fR
.fi
.RE

Find the maximum latency for each date, hour pair
.PP
.RS 4
.nf
\fBrecs collate --key date,hour --aggregator worst_latency=max,latency\fR
.fi
.RE

Produce a cumulative sum of profit up to each date
.PP
.RS 4
.nf
\fBrecs collate --key date --adjacent --incremental --aggregator profit_to_date=sum,profit\fR
.fi
.RE

Count clumps of adjacent lines with matching x fields
.PP
.RS 4
.nf
\fBrecs collate --adjacent --key x --aggregator count\fR
.fi
.RE

.SH SEE ALSO
\fBrecs\-decollate\fR(1), \fBrecs\-sort\fR(1), \fBrecs\-multiplex\fR(1)

.SH AUTHOR
Benjamin Bernard <perlhacker@benjaminbernard.com>

